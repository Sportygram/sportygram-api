# docker-compose.yml

version: "3.7"

services:
    sgram-db:
        image: postgres:latest
        restart: on-failure
        container_name: sgram-db
        environment:
            POSTGRES_DB: sgramdevdb
            POSTGRES_USER: sgram
            POSTGRES_PASSWORD: sgram
        volumes:
            - sgram-pgdata:/var/lib/postgresql/data
        logging:
            driver: json-file
        ports:
            - 8001:5432

    sgram-redis:
        image: redis
        container_name: sgram-cache
        logging:
            driver: json-file
        ports:
            - 6379:6379

    sgram-loki:
        image: grafana/loki:latest
        container_name: sgram-loki
        ports:
            - "3100:3100"
        command: -config.file=/etc/loki/local-config.yaml

    sgram-promtail:
        image: grafana/promtail:latest
        container_name: sgram-promtail
        volumes:
            - sgram-promtaildata:/var/log
        command: -config.file=/etc/promtail/docker-config.yaml

    sgram-grafana:
        image: grafana/grafana:master
        container_name: sgram-grafana
        ports:
            - "3200:3000"

volumes:
    sgram-pgdata:
    sgram-promtaildata:
